{% extends "open_survey_tool/default.html" %}

{% block head %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/survey-jquery/1.8.36/survey.jquery.min.js"
            integrity="sha512-kwgVF6SQW1TFaWG2YISAnhrAZR7zm7s72w+SIIVHlrTibvzGEoZoZr179cxIcrdL3BvbT6FYAv62CmGCmN+Zsg=="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/survey-knockout@1.8.36/modern.css"
          integrity="sha384-9ra4D8aAj6d7bADiQpmX1vrinmP9Fub8prrYixMBFHjUK/HN/Bh9+RVlBoL4+9If"
          crossorigin="anonymous">
    <title>
        Ask a user to rate a something
    </title>
{% endblock head %}

{% block content %}
    <div id="surveyElement" style="display:inline-block;width:100%;"></div>
    <div id="surveyResult"></div>
    <script type="text/javascript">

        Survey.StylesManager.applyTheme("modern");

        $.getJSON('/survey/content', function (content) {
            window.survey = new Survey.Model(content);

            survey
                .onComplete
                .add(function (result) {
                    const stringify = JSON.stringify(result.data);
                    document
                        .querySelector('#surveyResult')
                        .textContent = "Result JSON:\n" + stringify;

                    const body = {
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        submission: stringify
                    }
                    $.post('/results/', body)


                });

            survey.render("surveyElement");
        });


    </script>

{% endblock content %}

