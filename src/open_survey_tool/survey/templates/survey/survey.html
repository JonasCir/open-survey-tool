{% extends "open_survey_tool/default.html" %}

{% block head %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/survey-jquery/1.8.36/survey.jquery.min.js"
            integrity="sha512-kwgVF6SQW1TFaWG2YISAnhrAZR7zm7s72w+SIIVHlrTibvzGEoZoZr179cxIcrdL3BvbT6FYAv62CmGCmN+Zsg=="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/survey-knockout@1.8.36/modern.css"
          integrity="sha384-9ra4D8aAj6d7bADiQpmX1vrinmP9Fub8prrYixMBFHjUK/HN/Bh9+RVlBoL4+9If"
          crossorigin="anonymous">
    <title>
        Ask a user to rate a something
    </title>
{% endblock head %}

{% block content %}
    <div id="surveyElement" style="display:inline-block;width:100%;"></div>
    <div id="surveyResult"></div>
    <script type="text/javascript">

        Survey
            .StylesManager
            .applyTheme("modern");

        var json = {
            questions: [
                {
                    type: "rating",
                    name: "satisfaction",
                    title: "How satisfied are you with the Product?",
                    minRateDescription: "Not Satisfied",
                    maxRateDescription: "Completely satisfied"
                }
            ]
        };

        window.survey = new Survey.Model(json);

        survey
            .onComplete
            .add(function (result) {
                const stringify = JSON.stringify(result.data);
                document
                    .querySelector('#surveyResult')
                    .textContent = "Result JSON:\n" + stringify;

                $.ajax({
                    type: "POST",
                    url: "/results/",
                    data: {
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        submission: stringify
                    },
                    dataType: 'json',
                    success: function (response) {
                        console.log(response);
                    },
                    error: function (error) {
                        console.log("Something went wrong", error);
                    }
                });

            });

        survey.render("surveyElement");


    </script>

{% endblock content %}

